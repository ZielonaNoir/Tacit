这份文档是专门为 **Cursor** 准备的 **Tacit 项目蓝图**。它包含了完整的技术上下文、最终版数据库 Schema、以及核心架构代码。

你可以直接将以下内容复制到 Cursor 的 "Composer" (Ctrl+I / Cmd+I) 或者保存为 `CONTEXT.md` 让 Cursor 读取，然后开始自动生成代码。

-----

# Tacit: Project Blueprint (Cursor Context)

## 1\. Project Manifesto

**Project Name:** Tacit (Tacit.app)
**Concept:** A "frictionless" social event platform (Partiful clone).
**Key Value Props:**

1.  **No-Auth Participation:** Guests can vote on dates and RSVP without creating an account (using local UUIDs).
2.  **Date Polling:** "Find a time" feature intersecting availability.
3.  **Vibe First:** Highly customizable themes, retro/neon aesthetics.
4.  **Real-time:** Live guest list updates and activity feed.

## 2\. Tech Stack

  * **Framework:** Vue 3 (Composition API, Script Setup)
  * **Build Tool:** Vite
  * **Language:** TypeScript
  * **Styling:** Tailwind CSS (Custom "Neo-Brutalism" Config)
  * **Backend:** Supabase (Database, Auth, Realtime, Storage)
  * **State Management:** Pinia
  * **Utilities:** VueUse, date-fns

-----

## 3\. Database Schema (Run in Supabase SQL Editor)

This schema supports the "Hybrid Identity" system (Users + Anonymous Guests).

```sql
-- Enable UUID extension
create extension if not exists "uuid-ossp";

-- 1. PROFILES (Registered Users)
create table profiles (
  id uuid references auth.users not null primary key,
  username text unique,
  full_name text,
  avatar_url text,
  phone_number text, 
  social_links jsonb default '{}'::jsonb,
  created_at timestamptz default now()
);

-- 2. GUEST IDENTITIES (Anonymous / Shadow Users)
create table guest_identities (
  id uuid primary key, -- Generated by frontend (UUIDv4)
  display_name text not null,
  last_active_at timestamptz default now(),
  created_at timestamptz default now()
);

-- 3. ORGANIZATIONS
create table organizations (
  id uuid default uuid_generate_v4() primary key,
  handle text unique not null,
  name text not null,
  description text,
  logo_url text,
  social_links jsonb default '{}'::jsonb,
  created_at timestamptz default now()
);

create table org_members (
  org_id uuid references organizations(id),
  user_id uuid references profiles(id),
  role text check (role in ('owner', 'admin', 'member')),
  primary key (org_id, user_id)
);

-- 4. EVENTS (The Core)
create table events (
  id uuid default uuid_generate_v4() primary key,
  creator_id uuid references profiles(id),
  org_id uuid references organizations(id),
  
  -- Status flow: draft -> polling -> scheduled -> past
  status text default 'draft' check (status in ('draft', 'polling', 'scheduled', 'cancelled', 'past')),
  
  title text not null,
  description text,
  
  -- Timing (can be null during polling)
  start_time timestamptz,
  end_time timestamptz,
  timezone text default 'UTC',
  
  -- Location
  location_name text,
  location_address text,
  location_url text,
  
  -- Visuals & Config
  cover_image_url text,
  theme_config jsonb default '{}'::jsonb, -- { font, bg_effect, colors }
  modules_config jsonb default '{}'::jsonb, -- { spotify, registry }
  
  -- Constraints
  max_capacity int,
  show_guest_list boolean default true,
  
  created_at timestamptz default now()
);

-- 5. DATE POLLING (Find a time)
create table event_time_polls (
  id uuid default uuid_generate_v4() primary key,
  event_id uuid references events(id) not null,
  start_time timestamptz not null,
  end_time timestamptz
);

create table event_poll_votes (
  id uuid default uuid_generate_v4() primary key,
  poll_id uuid references event_time_polls(id) not null,
  
  -- Hybrid Identity: Must have either user_id OR guest_id
  user_id uuid references profiles(id),
  guest_id uuid references guest_identities(id),
  
  status text check (status in ('yes', 'if_need_be', 'no')),
  created_at timestamptz default now(),
  
  constraint check_identity check (user_id is not null or guest_id is not null)
);

-- 6. RSVPS & GUEST LIST
create table rsvps (
  id uuid default uuid_generate_v4() primary key,
  event_id uuid references events(id) not null,
  
  user_id uuid references profiles(id),
  guest_id uuid references guest_identities(id),
  
  status text not null check (status in ('going', 'maybe', 'not_going', 'waitlist')),
  guests_count int default 0, -- Plus ones
  comment text,
  phone_number text,
  
  created_at timestamptz default now(),
  
  constraint check_identity_rsvp check (user_id is not null or guest_id is not null),
  -- Prevent duplicate RSVP for same person
  constraint unique_user_rsvp unique nulls not distinct (event_id, user_id),
  constraint unique_guest_rsvp unique nulls not distinct (event_id, guest_id)
);

-- 7. ACTIVITY FEED
create table activities (
  id uuid default uuid_generate_v4() primary key,
  event_id uuid references events(id) not null,
  user_id uuid references profiles(id),
  guest_id uuid references guest_identities(id),
  
  type text check (type in ('blast', 'comment', 'photo', 'rsvp_log')),
  content text,
  media_url text,
  created_at timestamptz default now()
);

-- Enable RLS (Row Level Security) - Basic Setup
alter table profiles enable row level security;
alter table events enable row level security;
alter table rsvps enable row level security;

-- Policies (Simplified for dev start)
create policy "Public events are viewable by everyone" on events for select using (true);
create policy "Anyone can insert guest identity" on guest_identities for insert with check (true);
create policy "Anyone can read guest identities" on guest_identities for select using (true);
```

-----

## 4\. Directory Structure (Feature-Sliced Lite)

```text
src/
├── assets/
├── components/           # Shared UI (Button, Input, Modal)
├── lib/
│   ├── supabase.ts       # Client init
│   └── constants.ts
├── composables/
│   ├── useAuth.ts        # Supabase Auth wrapper
│   └── useGuestIdentity.ts # CRITICAL: LocalStorage UUID logic
├── modules/
│   ├── events/           # Event Core
│   │   ├── components/   # EventCard, EventHeader
│   │   ├── views/        # EventLayout, EventDetail, CreateEvent
│   │   ├── services.ts   # Event-specific DB calls
│   │   └── types.ts
│   ├── polls/            # Date Polling Logic
│   │   └── components/   # PollGrid, VoteButton
│   ├── rsvp/             # Guest List & RSVP Form
│   └── feed/             # Activity Feed & Comments
├── App.vue
└── main.ts
```

-----

## 5\. Core Configuration & Types

### Tailwind Configuration (`tailwind.config.js`)

*Use this to achieve the "Partiful" aesthetic.*

```javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{vue,js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        brand: {
          orange: '#FF4D00',
          purple: '#B829E3',
          blue: '#295CE3',
        },
        surface: {
          light: '#F8F9FA',
          dark: '#121212',
        }
      },
      fontFamily: {
        heading: ['"Chonburi"', 'serif'], // Import via Google Fonts
        body: ['"Inter"', 'sans-serif'],
      },
      boxShadow: {
        'retro': '4px 4px 0px 0px rgba(0,0,0,1)', // Hard shadow
      }
    },
  },
  plugins: [],
}
```

### TypeScript Types (`src/types/database.ts`)

```typescript
export type Json = string | number | boolean | null | { [key: string]: Json | undefined } | Json[]

export interface GuestIdentity {
  id: string
  display_name: string
}

export interface TacitEvent {
  id: string
  title: string
  description: string | null
  status: 'draft' | 'polling' | 'scheduled' | 'cancelled'
  start_time: string | null
  location_name: string | null
  theme_config: {
    font?: string
    effect?: string
    primary_color?: string
  }
  // ... other fields
}
```

### The "Guest Identity" Composable (`src/composables/useGuestIdentity.ts`)

*This is the logic to handle anonymous users.*

```typescript
import { useLocalStorage } from '@vueuse/core'
import { v4 as uuidv4 } from 'uuid'
import { computed } from 'vue'

export interface GuestStore {
  id: string
  display_name: string
  last_active: string
}

export function useGuestIdentity() {
  // Persist in localStorage
  const guestStore = useLocalStorage<GuestStore>('tacit-guest-v1', {
    id: uuidv4(),
    display_name: '',
    last_active: new Date().toISOString()
  })

  const isGuestSetup = computed(() => !!guestStore.value.display_name)

  const updateGuestProfile = (name: string) => {
    guestStore.value.display_name = name
    guestStore.value.last_active = new Date().toISOString()
    // TODO: Sync to backend 'guest_identities' table here
  }

  // Returns the payload for DB inserts (RSVPs, Votes)
  // Logic: "Who am I? User ID or Guest ID?"
  const getIdentityPayload = (userId?: string | null) => {
    if (userId) return { user_id: userId, guest_id: null }
    return { user_id: null, guest_id: guestStore.value.id }
  }

  return {
    guestId: guestStore.value.id,
    guestName: guestStore.value.display_name,
    isGuestSetup,
    updateGuestProfile,
    getIdentityPayload
  }
}
```

-----

## 6\. Cursor Instructions (How to start)

**Step 1: Initialize Project**

> "Hey Cursor, I am starting the Tacit project. Please initialize a Vue 3 + TypeScript + Vite project in the current directory. Then, install `tailwindcss`, `autoprefixer`, `postcss`, `@supabase/supabase-js`, `@vueuse/core`, `uuid`, `date-fns`, `pinia`, and `vue-router`."

**Step 2: Setup Backend Connection**

> "Create `src/lib/supabase.ts` and initialize the client using `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY`. Also, create the `useGuestIdentity.ts` composable based on the code provided in the blueprint."

**Step 3: Build the Event View**

> "Create the `src/modules/events/views/EventDetail.vue`. It should fetch event data by ID from the `events` table.
> Use the `theme_config` JSONB data to dynamically style the page background and fonts.
> Render a 'Retro' style card using Tailwind classes like `shadow-retro` and `border-2 border-black`."

**Step 4: Implement Polling (The Feature)**

> "Implement the 'Find a Time' feature.
>
> 1.  Create a `PollSection.vue` component.
> 2.  Fetch options from `event_time_polls`.
> 3.  Allow the user to vote. Use `useGuestIdentity` to determine if I am submitting as a logged-in user or a guest. Insert into `event_poll_votes`."